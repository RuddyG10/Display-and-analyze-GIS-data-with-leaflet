<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Webmap 201</title>
        <link rel="stylesheet" href="src/leaflet/leaflet.css">
        <link rel="stylesheet" href="src/bootstrap-4.0.0-dist/css/bootstrap.css">
        <script src="src/leaflet/leaflet.js"></script>
        <script src="src/code.jquery.com_jquery-3.7.0.min.js"></script>

        <style>
            #mapdiv{
                height: 100vh;
            }
        </style>
    </head>
    <body>
        <div id="side-bar" class="col-md-3">
            <button id="btnLocate" class="btn btn-primary btn-block">Locate</button>
            <button id="btnPucmm" class="btn btn-primary btn-block">ZoomToPUCMM</button>
            <h4>Zoom level: <span id="zoom-level"></span></h4>
            <h4>Map Center: <span id="map-center"></span></h4>
            <h4>Mouse Location: <span id="mouse-location"></span></h4>
        </div>
        <div id="mapdiv" class="col-md-9">

            <script>
                //Variables declarations
                var mymap;
                var lyrOsm;
                var markerCurrentLocation;
                $(document).ready(function(){
                    mymap = L.map('mapdiv',{center:[19.44, -70.68],zoom:13});
                    lyrOsm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
                    mymap.addLayer(lyrOsm);

                    //what this function does is that set an interval of time to activate a function, in this case when you interact with the map, it will activate the locate function every 5 secs, it is helpfull in mobile devices. It takes first param the function and second the time in milsecs.

                    /*
                    setInterval(function(){
                        mymap.locate();
                    }, 5000)

                    */

                    //Here is the function that when we cick on the map wi will get the latitude and longitud in an alert and if we click it while pressing shift key,we will get the zoom of the map in the alert.
                    mymap.on('click',function(e){
                        
                        if(e.originalEvent.shiftKey){
                            alert(mymap.getZoom());
                        }
                        else{
                            alert(e.latlng.toString());
                        }
                    });

                    //put a marker with right click and if we click the marker wi will get the latitude and longitude with the actual date in a popUp
                    mymap.on('contextmenu',function(e){
                        //get the current time
                        var dtCurrentTime = new Date();

                        L.marker(e.latlng).addTo(mymap).bindPopup(e.latlng.toString()+ "<br>"+dtCurrentTime.toString());
                    });

                    mymap.on('keypress',function(e){
                        //console.log(e);
                        if(e.originalEvent.key =="l"){
                            mymap.locate();
                        }

                        mymap.on('locationfound',function(e){
                            console.log(e);
                            //it verify if a marker has been setted to remove the last marked that it had. It helps to not overwrite a marker every time
                            if(markerCurrentLocation){
                                markerCurrentLocation.remove();
                            }
                            
                            //The marker is a tiny circle that shows where you are
                            markerCurrentLocation= L.circleMarker(e.latlng).addTo(mymap);
                            
                            //this one is the same as the last marker but is a wider circle that takes as a radius the accuracy of your location /2, the accuracy is the diameter of your location

                            //markerCurrentLocation= L.circle(e.latlng,{radius:e.accuracy/2}).addTo(mymap);
                            mymap.setView(e.latlng,14);
                        });

                        mymap.on('locationerror',function(e){
                            console.log(e);
                            alert("location not found");
                        });
                    });
                    mymap.on('zoomend',function(){

                        $("#zoom-level").html(mymap.getZoom());
                    });

                    mymap.on('moveend',function(){
                        $("#map-center").html(mymap.getCenter().toString());
                    });

                    mymap.on('mousemove',function(e){
                        $("#mouse-location").html(LatLngToArrayString(e.latlng));
                    });

                    $("#btnLocate").click(function(){
                        mymap.locate();
                        mymap.on('locationfound',function(e){
                            console.log(e);
                            //it verify if a marker has been setted to remove the last marked that it had. It helps to not overwrite a marker every time
                            if(markerCurrentLocation){
                                markerCurrentLocation.remove();
                            }
                            
                            //The marker is a tiny circle that shows where you are
                            markerCurrentLocation= L.circleMarker(e.latlng).addTo(mymap);
                            
                            //this one is the same as the last marker but is a wider circle that takes as a radius the accuracy of your location /2, the accuracy is the diameter of your location

                            //markerCurrentLocation= L.circle(e.latlng,{radius:e.accuracy/2}).addTo(mymap);
                            mymap.setView(e.latlng,14);
                        });

                        mymap.on('locationerror',function(e){
                            console.log(e);
                            alert("location not found");
                        });
                    });

                    $("#btnPucmm").click(function(){
                        mymap.setView([19.444406, -70.683717],17);
                    });
                });
                
                function LatLngToArrayString(ll){
                    return "["+ll.lat.toFixed(5)+","+ll.lng.toFixed(5)+"]";
                }
            </script>
        </div>
    </body>
</html>