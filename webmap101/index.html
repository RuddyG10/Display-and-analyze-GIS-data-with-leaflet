<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Webmap 201</title>
        <link rel="stylesheet" href="src/leaflet/leaflet.css">
        <link rel="stylesheet" href="src/bootstrap-4.0.0-dist/css/bootstrap.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/fontawesome.min.css" integrity="sha384-QYIZto+st3yW+o8+5OHfT6S482Zsvz2WfOzpFSXMF9zqeLcFV0/wlZpMtyFcZALm" crossorigin="anonymous">
        <link rel="stylesheet" href="src/plugins/Leaflet.Pancontrol/src/L.Control.Pan.css">
        <link rel="stylesheet" href="src/plugins/Leaflet.zoomslider/src/L.Control.Zoomslider.css">
        <link rel="stylesheet" href="src/plugins/Leaflet.MousePosition/src/L.Control.MousePosition.css">
        <link rel="stylesheet" href="src/plugins/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.css">
        <link rel="stylesheet" href="src/plugins/Leaflet.EasyButton/src/easy-button.css">
        <link rel="stylesheet" href="src/plugins/leaflet-sidebar/src/L.Control.Sidebar.css">

        <script src="src/leaflet/leaflet.js"></script>
        <script src="src/code.jquery.com_jquery-3.7.0.min.js"></script>
        <script src="src/bootstrap-4.0.0-dist/js/bootstrap.js"></script>
        <script src="src/plugins/Leaflet.Pancontrol/src/L.Control.Pan.js"></script>
        <script src="src/plugins/Leaflet.zoomslider/src/L.Control.Zoomslider.js"></script>
        <script src="src/plugins/Leaflet.MousePosition/src/L.Control.MousePosition.js"></script>
        <script src="src/plugins/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js"></script>
        <script src="src/plugins/Leaflet.EasyButton/src/easy-button.js"></script>
        <script src="src/plugins/leaflet-sidebar/src/L.Control.Sidebar.js"></script>
        <script src="src/plugins/leaflet-providers/leaflet-providers.js"></script>
        <style>
            #mapdiv{
                height: 100vh;
            }
        </style>
    </head>
    <body>
        <div id="side-bar" class="col-md-12">
            <button id="btnLocate" class="btn btn-primary btn-block">Locate</button>
            <button id="btnPucmm" class="btn btn-primary btn-block">ZoomToPUCMM</button>
            <h4>Zoom level: <span id="zoom-level"></span></h4>
            <h4>Map Center: <span id="map-center"></span></h4>
            <h4>Mouse Location: <span id="mouse-location"></span></h4>
        </div>
        <div id="mapdiv">
            
            <script>
                //Variables declarations
                var mymap;
                var lyrOsm;
                var lyrWaterColor;
                var lyrTopo;
                var lyrImagery;
                var lyrOutdoors;
                var markerCurrentLocation;
                var locationEnabled = false;
                var popPucmm;
                var popExample;
                var controlZoom;
                var controlAttribute;
                var controlScale;
                var controlPan;
                var controlZSlider;
                var mousePosition;
                var controlMeasure;
                var easyButton;
                var controlSideBar;
                var controlLayers;
                var objBasemaps;
                var objLayers;
                $(document).ready(function(){
                    mymap = L.map('mapdiv',{center:[19.44, -70.68],zoom:13, zoomControl:false, attributionControl:false});

                    //we add .provider for apply the provider plugin
                    lyrOsm = L.tileLayer.provider('OpenStreetMap.Mapnik');
                    mymap.addLayer(lyrOsm);
                    //added some layers from provider plugin
                    lyrTopo = L.tileLayer.provider('OpenTopoMap');
                    mymap.addLayer(lyrOsm);
                    lyrImagery = L.tileLayer.provider('Esri.WorldImagery');
                    mymap.addLayer(lyrOsm);
                    lyrOutdoors = L.tileLayer.provider('Stadia.Outdoors');
                    mymap.addLayer(lyrOsm);
                    lyrWaterColor = L.tileLayer.provider('Stamen.Watercolor');
                    mymap.addLayer(lyrOsm);
                    //object basemaps
                    objBasemaps = {
                        "Open Street Maps": lyrOsm,
                        "Topo Map": lyrTopo,
                        "Imagery":lyrImagery,
                        "Outdoors":lyrOutdoors,
                        "Watercolor":lyrWaterColor
                    };

                    //Object layers options
                    objLayers = {};

                    //control layers
                    controlLayers = L.control.layers(objBasemaps, objLayers).addTo(mymap);
                    //Pan control
                    controlPan = L.control.pan().addTo(mymap);
                    
                    //Side bar
                    controlSideBar = L.control.sidebar('side-bar').addTo(mymap);
                    //Zoom slider
                    controlZSlider = L.control.zoomslider({position:'topright'}).addTo(mymap);

                    //Control zoom 
                    controlZoom = L.control.zoom({zoomInText:'In',zoomOutText:'Out', position:'topright'});
                    controlZoom.addTo(mymap);

                    //Polyline Measure control
                    controlMeasure = L.control.polylineMeasure().addTo(mymap);

                    //Easy Buttom to lacation
                    easyButton = L.easyButton('<i class="bi bi-compass-fill"></i>',function(){

                        //First it checks if it was pressed already, if it was the location will stop
                        if(locationEnabled){
                            mymap.stopLocate();
                            markerCurrentLocation.remove();
                            locationEnabled = false;
                        }
                        else{
                            mymap.locate();
                            locationEnabled = true;
                        }
                        
                    }).addTo(mymap);

                    //button to open the side bar
                    easyButton = L.easyButton('<i class="bi bi-layout-sidebar-inset"></i>',function(){
                        controlSideBar.toggle();
                        
                    }).addTo(mymap);

                    //Attribution control
                    controlAttribute = L.control.attribution({position:'bottomleft'}).addTo(mymap);
                    controlAttribute.addAttribution('OSM');
                    controlAttribute.addAttribution('<a href="https://pucmm.edu.do/">PUCMM</a>');

                    
                    
                    //Control scale, it shows the scale of the map
                    controlScale = L.control.scale({position:'bottomleft',metric:false,maxWidth:200}).addTo(mymap);
                    //Mouse position
                    mousePosition = L.control.mousePosition().addTo(mymap);
                    //Pucmm popUp
                    popPucmm = L.popup({maxWidth:200,keepInView:true});
                    //we set the location of Pucmm Santiago
                    popPucmm.setLatLng([19.444406, -70.683717]);
                    //The content that the popUp will have
                    popPucmm.setContent("<h2>PUCMM</h2><img src='img/PUCMM-Campus-Santiago.jpg' width='200px'>")


                    //In this popUp we will show the side-bar elements inside it.
                    /*
                    popExample = L.popup();
                    popExample.setLatLng([19.444406, -70.683717]);
                    popExample.setContent($("#side-bar")[0]);
                    popExample.openOn(mymap);
                    */
                    //what this function does is that set an interval of time to activate a function, in this case when you interact with the map, it will activate the locate function every 5 secs, it is helpfull in mobile devices. It takes first param the function and second the time in milsecs.

                    /*
                    setInterval(function(){
                        mymap.locate();
                    }, 5000)

                    */

                    //Here is the function that when we cick on the map wi will get the latitude and longitud in an alert and if we click it while pressing shift key,we will get the zoom of the map in the alert.

                    /*
                    mymap.on('click',function(e){
                        
                        if(e.originalEvent.shiftKey){
                            alert(mymap.getZoom());
                        }
                        else{
                            alert(e.latlng.toString());
                        }
                    });
                    */
                    //put a marker with right click and if we click the marker wi will get the latitude and longitude with the actual date in a popUp
                    mymap.on('contextmenu',function(e){
                        //get the current time
                        var dtCurrentTime = new Date();

                        L.marker(e.latlng).addTo(mymap).bindPopup(e.latlng.toString()+ "<br>"+dtCurrentTime.toString());
                    });

                    mymap.on('keypress',function(e){
                        //console.log(e);
                        if(e.originalEvent.key =="l"){
                            mymap.locate();
                        }

                        
                    });

                    //Location Verifyers
                    mymap.on('locationfound',function(e){
                            console.log(e);
                            //it verify if a marker has been setted to remove the last marked that it had. It helps to not overwrite a marker every time
                            
                           
                                //The marker is a tiny circle that shows where you are
                            markerCurrentLocation= L.circleMarker(e.latlng).addTo(mymap);
                            
                            //this one is the same as the last marker but is a wider circle that takes as a radius the accuracy of your location /2, the accuracy is the diameter of your location

                            //markerCurrentLocation= L.circle(e.latlng,{radius:e.accuracy/2}).addTo(mymap);
                            mymap.setView(e.latlng,14);
                            
                                
                            
                            
                        });

                        mymap.on('locationerror',function(e){
                            console.log(e);
                            alert("location not found");
                        });

                    //when we finish to zoom, it will get the current zoom and pass it to the zoom-level label
                    mymap.on('zoomend',function(){

                        $("#zoom-level").html(mymap.getZoom());
                    });

                    //When we finished to move, it will get the current coordinates to the center of the map and pass it to the map-center label
                    mymap.on('moveend',function(){
                        $("#map-center").html(mymap.getCenter().toString());
                    });

                    //When we mode the cursor, it will get the current coordinates of the cursor in the map and pass it to the mouse-location label
                    mymap.on('mousemove',function(e){
                        $("#mouse-location").html(LatLngToArrayString(e.latlng));
                    });

                    //button location function
                    $("#btnLocate").click(function(){
                        mymap.locate();
                    });

                    //This function zoom to pucmm
                    $("#btnPucmm").click(function(){
                        mymap.setView([19.444406, -70.683717],17);

                        //it will open the popup that we created above
                        mymap.openPopup(popPucmm);
                    });
                });
                
                function LatLngToArrayString(ll){
                    return "["+ll.lat.toFixed(5)+","+ll.lng.toFixed(5)+"]";
                }
            </script>
        </div>
    </body>
</html>